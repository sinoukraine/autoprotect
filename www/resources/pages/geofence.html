<!--suppress JSAnnotator -->
<template>
    <div class="page " data-name="geofence"> <!-- page-with-subnavbar -->
        <!-- Top Navbar -->
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="link icon-only back" >
                        <i class="if-not-ios f7-icons icon-header-arrow-back"></i>
                        <i class="if-ios icon icon-back"></i>
                    </a>
                </div>
                <div class="title sliding">
                    {{@global.LANGUAGE.ASSET_EDIT_MSG00}}
                </div>
                <div class="right">
                    <label for="submit-form" class="link icon-only">
                        <i class="f7-icons icon-header-apply"></i>
                    </label>
                </div>
            </div>
        </div>

        <form class="page-content" name="AssetEditForm">
            <input type="submit" id="submit-form" class="display-none" />
            <div class="geofence-map-wrapper">
                <div id="{{MapId}}" class="map"></div>
            </div>
            <div class="block-title">{{@global.LANGUAGE.GEOFENCES_MSG02}}</div>
            <div class="list no-hairline-bottom">
                <ul>
                    <li>
                        <a class="item-link smart-select smart-select-init custom-smart-select" data-open-in="popup" data-close-on-select="true" data-form-color-theme="green" data-searchbar="true" data-searchbar-placeholder="{{@global.LANGUAGE.COM_MSG02}}" data-append-searchbar-not-found="{{@global.LANGUAGE.PROMPT_MSG000}}" data-page-title = "{{@global.LANGUAGE.COM_MSG065}}" >
                            <select name="Assets" multiple>
                                {{#each AssetList}}
                                    <option value="{{this.IMEI}}" >{{this.Name}}</option>
                                {{/each}}
                            </select>
                            <div class="item-content">
                                <div class="item-media text-color-lightgray">
                                    <!--<i class="f7-icons icon-live-speed"></i>-->
                                </div>
                                <div class="item-inner">
                                    <div class="item-title ">{{@global.LANGUAGE.COM_MSG065}}</div>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
            <!--


            <div class="block-title">{{@global.LANGUAGE.ASSET_EDIT_MSG12}}</div>
            <div class="list no-hairline-bottom">
                <ul>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">
                                <i class="f7-icons icon-name"></i>
                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label item-label">{{@global.LANGUAGE.ASSET_EDIT_MSG03}}</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="Name" placeholder="Asset name" value="{{Name}}" maxlength="200" required validate>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">

                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label item-label">{{@global.LANGUAGE.ASSET_EDIT_MSG04}}</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="Registration" placeholder="{{@global.LANGUAGE.ASSET_EDIT_MSG04}}" value="{{Registration}}" maxlength="200"  >
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">
                                &lt;!&ndash; <i class="f7-icons icon-name"></i> &ndash;&gt;
                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label item-label">{{@global.LANGUAGE.ASSET_EDIT_MSG05}}</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="Describe1" placeholder="{{@global.LANGUAGE.ASSET_EDIT_MSG05}}" value="{{Describe1}}" maxlength="200"  >
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">
                                &lt;!&ndash; <i class="f7-icons icon-name"></i> &ndash;&gt;
                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label item-label">{{@global.LANGUAGE.ASSET_EDIT_MSG06}}</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="Describe2" placeholder="{{@global.LANGUAGE.ASSET_EDIT_MSG06}}" value="{{Describe2}}" maxlength="200"  >
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">
                                &lt;!&ndash; <i class="f7-icons icon-name"></i> &ndash;&gt;
                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label item-label">{{@global.LANGUAGE.ASSET_EDIT_MSG07}}</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="Describe3" placeholder="{{@global.LANGUAGE.ASSET_EDIT_MSG07}}" value="{{Describe3}}" maxlength="200"  >
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">
                                &lt;!&ndash; <i class="f7-icons icon-name"></i> &ndash;&gt;
                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label item-label">{{@global.LANGUAGE.ASSET_EDIT_MSG08}}</div>
                                <div class="item-input-wrap">
                                    <input type="tel" name="Describe4" placeholder="{{@global.LANGUAGE.ASSET_EDIT_MSG08}}" value="{{Describe4}}" maxlength="4" pattern="[0-9]*" data-error-message="{{@global.LANGUAGE.PROMPT_MSG022}}"  >
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <a class="item-link smart-select smart-select-init custom-smart-select" data-open-in="sheet" data-close-on-select="true" data-form-color-theme="green" data-sheet-push="true">
                            <select name="Unit" >
                                <option value="KPH" {{#js_if "this.Unit == 'KPH' "}} selected {{/js_if}}>km/h</option>
                                <option value="MPH" {{#js_if "this.Unit == 'MPH' "}} selected {{/js_if}}>mile/h</option>
                                <option value="MPS" {{#js_if "this.Unit == 'MPS' "}} selected {{/js_if}}>m/s</option>
                                <option value="KT" {{#js_if "this.Unit == 'KT' "}} selected {{/js_if}}>kt</option>
                            </select>
                            <div class="item-content">
                                <div class="item-media text-color-lightgray">
                                    <i class="f7-icons icon-live-speed"></i>
                                </div>
                                <div class="item-inner">
                                    <div class="item-title ">{{@global.LANGUAGE.ASSET_EDIT_MSG09}}</div>
                                </div>
                            </div>
                        </a>
                    </li>

                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">
                                &lt;!&ndash; <i class="f7-icons icon-name"></i> &ndash;&gt;
                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label item-label">{{@global.LANGUAGE.ASSET_EDIT_MSG22}}</div>
                                <div class="item-input-wrap">
                                    <input type="tel" name="MaxSpeed" placeholder="{{@global.LANGUAGE.ASSET_EDIT_MSG22}}" value="{{MaxSpeed}}" maxlength="4" pattern="[0-9]*" data-error-message="{{@global.LANGUAGE.PROMPT_MSG022}}"  validate >
                                </div>
                            </div>
                        </div>
                    </li>




                </ul>
            </div>

            <div class="block-title">{{@global.LANGUAGE.ASSET_EDIT_MSG13}}</div>
            <div class="list no-hairline-bottom">
                <ul>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">
                                <i class="f7-icons icon-live-initial"></i>
                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label">{{@global.LANGUAGE.ASSET_EDIT_MSG10}}</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="Mileage" placeholder="{{@global.LANGUAGE.ASSET_EDIT_MSG10}}" value="{{InitMileage}}" maxlength="200" pattern="[-0-9]*" data-error-message="{{@global.LANGUAGE.PROMPT_MSG022}}" validate >
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-media text-color-lightgray">
                                &lt;!&ndash; <i class="f7-icons icon-name"></i> &ndash;&gt;
                            </div>
                            <div class="item-inner">
                                <div class="item-title item-floating-label">{{@global.LANGUAGE.ASSET_EDIT_MSG11}}</div>
                                <div class="item-input-wrap">
                                    <input type="text" name="Runtime" placeholder="{{@global.LANGUAGE.ASSET_EDIT_MSG11}}" value="{{InitAcconHours}}" maxlength="200" pattern="[-0-9]*" data-error-message="{{@global.LANGUAGE.PROMPT_MSG022}}"  validate>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>-->

        </form>


    </div>
</template>


<script>
    // script must return component object
    return {
        data: function () {
            let self = this;

            let assetListObj = self.$app.methods.getFromStorage("assetList");
            let keys = Object.keys(assetListObj);
            let assetList = [];
            for (const key of keys) {
                assetList.push(assetListObj[key]);
            }
            assetList.sort(function(a, b) {
                if (a.Name < b.Name) return -1;
                if (a.Name > b.Name) return 1;
                return 0;
            });

            return {
                AssetList: assetList,
                MapId: 'map-' + self.$app.utils.id(),
            };

        },
        methods: {
            /*saveAssetDetails: function(data){
                let self = this;

                self.$app.preloader.show();
                self.$app.request.promise.post(API_URL.EDIT_DEVICE, data, 'json')
                    .then(function (result) {
                        self.$app.preloader.hide();

                        if(result.data.MajorCode === '000') {
                            let device = self.$app.methods.setAssetList({device: data});
                            if (VirtualAssetListMain){
                                let index = VirtualAssetListMain.items.findIndex(item => item.IMEI === device.IMEI);
                                VirtualAssetListMain.replaceItem(index, device);
                            }
                             mainView.router.back({force: true, ignoreCache: true});
                        }else{
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG023 + `<br>MajorCode: ${result.data.MajorCode}<br>MinorCode: ${result.data.MinorCode}<br>${result.data.Data}`);
                        }
                    })
                    .catch(function (err) {
                        self.$app.preloader.hide();
                        if (err && err.status === 404){
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG002);
                        }else{
                            self.$app.dialog.alert(LANGUAGE.PROMPT_MSG003);
                        }
                });
            },

            */
        },

        on: {
            pageInit: function (e, page) {
                let self = this;

                self.Map = Protocol.Helper.createMap({ target: self.MapId, latLng: [0,0], zoom: 2 });

                let form = page.$el.find('[name = "AssetEditForm"]');

                form.on('submit', function(e){
                    e.preventDefault();

                    /*let data = {
                        MinorToken: self.$app.data.MinorToken,
                        MajorToken: self.$app.data.MajorToken,
                        Code: self.Id,
                        IMEI: self.IMEI,
                        name: page.$el.find('input[name="Name"]').val(),
                        registration: page.$el.find('input[name="Registration"]').val(),

                        speedUnit: page.$el.find('select[name="Unit"]').val(),
                        initMileage: page.$el.find('input[name="Mileage"]').val(),
                        initAccHours: page.$el.find('input[name="Runtime"]').val(),
                        attr1: page.$el.find('input[name="Describe1"]').val(),
                        attr2: page.$el.find('input[name="Describe2"]').val(),
                        attr3: page.$el.find('input[name="Describe3"]').val(),
                        attr4: page.$el.find('input[name="Describe4"]').val(),
                        MaxSpeed: page.$el.find('input[name="MaxSpeed"]').val(),

                    };

                    let assetImg = page.$el.find('.user-img');// $$('.top-asset-img .item_asset_img');
                    if (assetImg.length && assetImg.data('name')) {
                        data.icon = assetImg.data('name');
                    }
                     console.log(data);
                    self.saveAssetDetails(data);*/

                    return false;
                });




            },
            pageAfterIn:function(){
                let self = this;



            },
            pageAfterOut: function () {
                // page has left the view
            },

        }
    };
</script>